import{r as J,b as z,d as H,e as j,f as N,h as T,i as B,j as $,k as A,g as I}from"./@babel.ab050653.js";var M={},S={exports:{}},L;function F(){return L||(L=1,function(C){var g=Object.prototype.hasOwnProperty,d="~";function k(){}Object.create&&(k.prototype=Object.create(null),new k().__proto__||(d=!1));function q(h,o,i){this.fn=h,this.context=o,this.once=i||!1}function O(h,o,i,c,_){if(typeof i!="function")throw new TypeError("The listener must be a function");var m=new q(i,c||h,_),l=d?d+o:o;return h._events[l]?h._events[l].fn?h._events[l]=[h._events[l],m]:h._events[l].push(m):(h._events[l]=m,h._eventsCount++),h}function w(h,o){--h._eventsCount===0?h._events=new k:delete h._events[o]}function y(){this._events=new k,this._eventsCount=0}y.prototype.eventNames=function(){var o=[],i,c;if(this._eventsCount===0)return o;for(c in i=this._events)g.call(i,c)&&o.push(d?c.slice(1):c);return Object.getOwnPropertySymbols?o.concat(Object.getOwnPropertySymbols(i)):o},y.prototype.listeners=function(o){var i=d?d+o:o,c=this._events[i];if(!c)return[];if(c.fn)return[c.fn];for(var _=0,m=c.length,l=new Array(m);_<m;_++)l[_]=c[_].fn;return l},y.prototype.listenerCount=function(o){var i=d?d+o:o,c=this._events[i];return c?c.fn?1:c.length:0},y.prototype.emit=function(o,i,c,_,m,l){var f=d?d+o:o;if(!this._events[f])return!1;var r=this._events[f],p=arguments.length,n,e;if(r.fn){switch(r.once&&this.removeListener(o,r.fn,void 0,!0),p){case 1:return r.fn.call(r.context),!0;case 2:return r.fn.call(r.context,i),!0;case 3:return r.fn.call(r.context,i,c),!0;case 4:return r.fn.call(r.context,i,c,_),!0;case 5:return r.fn.call(r.context,i,c,_,m),!0;case 6:return r.fn.call(r.context,i,c,_,m,l),!0}for(e=1,n=new Array(p-1);e<p;e++)n[e-1]=arguments[e];r.fn.apply(r.context,n)}else{var v=r.length,t;for(e=0;e<v;e++)switch(r[e].once&&this.removeListener(o,r[e].fn,void 0,!0),p){case 1:r[e].fn.call(r[e].context);break;case 2:r[e].fn.call(r[e].context,i);break;case 3:r[e].fn.call(r[e].context,i,c);break;case 4:r[e].fn.call(r[e].context,i,c,_);break;default:if(!n)for(t=1,n=new Array(p-1);t<p;t++)n[t-1]=arguments[t];r[e].fn.apply(r[e].context,n)}}return!0},y.prototype.on=function(o,i,c){return O(this,o,i,c,!1)},y.prototype.once=function(o,i,c){return O(this,o,i,c,!0)},y.prototype.removeListener=function(o,i,c,_){var m=d?d+o:o;if(!this._events[m])return this;if(!i)return w(this,m),this;var l=this._events[m];if(l.fn)l.fn===i&&(!_||l.once)&&(!c||l.context===c)&&w(this,m);else{for(var f=0,r=[],p=l.length;f<p;f++)(l[f].fn!==i||_&&!l[f].once||c&&l[f].context!==c)&&r.push(l[f]);r.length?this._events[m]=r.length===1?r[0]:r:w(this,m)}return this},y.prototype.removeAllListeners=function(o){var i;return o?(i=d?d+o:o,this._events[i]&&w(this,i)):(this._events=new k,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=d,y.EventEmitter=y,C.exports=y}(S)),S.exports}(function(C){var g=A;Object.defineProperty(C,"__esModule",{value:!0}),C.default=void 0;var d=g(J()),k=g(z()),q=g(H()),O=g(j()),w=g(N()),y=g(T()),h=g(B()),o=g($()),i=F();function c(f){var r=_();return function(){var n=(0,o.default)(f),e;if(r){var v=(0,o.default)(this).constructor;e=Reflect.construct(n,arguments,v)}else e=n.apply(this,arguments);return(0,h.default)(this,e)}}function _(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var m=function(f,r){var p={};for(var n in f)Object.prototype.hasOwnProperty.call(f,n)&&r.indexOf(n)<0&&(p[n]=f[n]);if(f!=null&&typeof Object.getOwnPropertySymbols=="function")for(var e=0,n=Object.getOwnPropertySymbols(f);e<n.length;e++)r.indexOf(n[e])<0&&Object.prototype.propertyIsEnumerable.call(f,n[e])&&(p[n[e]]=f[n[e]]);return p},l=function(f){(0,y.default)(p,f);var r=c(p);function p(n){var e,v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"ws://localhost:8080",t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},u=arguments.length>3?arguments[3]:void 0;(0,O.default)(this,p);var s=t.autoconnect,a=s===void 0?!0:s,b=t.reconnect,E=b===void 0?!0:b,R=t.reconnect_interval,x=R===void 0?1e3:R,P=t.max_reconnects,W=P===void 0?5:P,G=m(t,["autoconnect","reconnect","reconnect_interval","max_reconnects"]);return e=r.call(this),e.webSocketFactory=n,e.queue={},e.rpc_id=0,e.address=v,e.autoconnect=a,e.ready=!1,e.reconnect=E,e.reconnect_timer_id=void 0,e.reconnect_interval=x,e.max_reconnects=W,e.rest_options=G,e.current_reconnects=0,e.generate_request_id=u||function(){return++e.rpc_id},e.autoconnect&&e._connect(e.address,Object.assign({autoconnect:e.autoconnect,reconnect:e.reconnect,reconnect_interval:e.reconnect_interval,max_reconnects:e.max_reconnects},e.rest_options)),e}return(0,w.default)(p,[{key:"connect",value:function(){this.socket||this._connect(this.address,Object.assign({autoconnect:this.autoconnect,reconnect:this.reconnect,reconnect_interval:this.reconnect_interval,max_reconnects:this.max_reconnects},this.rest_options))}},{key:"call",value:function(e,v,t,u){var s=this;return!u&&(0,q.default)(t)==="object"&&(u=t,t=null),new Promise(function(a,b){if(!s.ready)return b(new Error("socket not ready"));var E=s.generate_request_id(e,v),R={jsonrpc:"2.0",method:e,params:v||null,id:E};s.socket.send(JSON.stringify(R),u,function(x){if(x)return b(x);s.queue[E]={promise:[a,b]},t&&(s.queue[E].timeout=setTimeout(function(){delete s.queue[E],b(new Error("reply timeout"))},t))})})}},{key:"login",value:function(){var n=(0,k.default)(d.default.mark(function v(t){var u;return d.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.call("rpc.login",t);case 2:if(u=a.sent,u){a.next=5;break}throw new Error("authentication failed");case 5:return a.abrupt("return",u);case 6:case"end":return a.stop()}},v,this)}));function e(v){return n.apply(this,arguments)}return e}()},{key:"listMethods",value:function(){var n=(0,k.default)(d.default.mark(function v(){return d.default.wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,this.call("__listMethods");case 2:return u.abrupt("return",u.sent);case 3:case"end":return u.stop()}},v,this)}));function e(){return n.apply(this,arguments)}return e}()},{key:"notify",value:function(e,v){var t=this;return new Promise(function(u,s){if(!t.ready)return s(new Error("socket not ready"));var a={jsonrpc:"2.0",method:e,params:v||null};t.socket.send(JSON.stringify(a),function(b){if(b)return s(b);u()})})}},{key:"subscribe",value:function(){var n=(0,k.default)(d.default.mark(function v(t){var u;return d.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return typeof t=="string"&&(t=[t]),a.next=3,this.call("rpc.on",t);case 3:if(u=a.sent,!(typeof t=="string"&&u[t]!=="ok")){a.next=6;break}throw new Error("Failed subscribing to an event '"+t+"' with: "+u[t]);case 6:return a.abrupt("return",u);case 7:case"end":return a.stop()}},v,this)}));function e(v){return n.apply(this,arguments)}return e}()},{key:"unsubscribe",value:function(){var n=(0,k.default)(d.default.mark(function v(t){var u;return d.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return typeof t=="string"&&(t=[t]),a.next=3,this.call("rpc.off",t);case 3:if(u=a.sent,!(typeof t=="string"&&u[t]!=="ok")){a.next=6;break}throw new Error("Failed unsubscribing from an event with: "+u);case 6:return a.abrupt("return",u);case 7:case"end":return a.stop()}},v,this)}));function e(v){return n.apply(this,arguments)}return e}()},{key:"close",value:function(e,v){this.socket.close(e||1e3,v)}},{key:"_connect",value:function(e,v){var t=this;clearTimeout(this.reconnect_timer_id),this.socket=this.webSocketFactory(e,v),this.socket.addEventListener("open",function(){t.ready=!0,t.emit("open"),t.current_reconnects=0}),this.socket.addEventListener("message",function(u){var s=u.data;s instanceof ArrayBuffer&&(s=Buffer.from(s).toString());try{s=JSON.parse(s)}catch{return}if(s.notification&&t.listeners(s.notification).length){if(!Object.keys(s.params).length)return t.emit(s.notification);var a=[s.notification];if(s.params.constructor===Object)a.push(s.params);else for(var b=0;b<s.params.length;b++)a.push(s.params[b]);return Promise.resolve().then(function(){t.emit.apply(t,a)})}if(!t.queue[s.id])return s.method&&s.params?Promise.resolve().then(function(){t.emit(s.method,s.params)}):void 0;"error"in s=="result"in s&&t.queue[s.id].promise[1](new Error('Server response malformed. Response must include either "result" or "error", but not both.')),t.queue[s.id].timeout&&clearTimeout(t.queue[s.id].timeout),s.error?t.queue[s.id].promise[1](s.error):t.queue[s.id].promise[0](s.result),delete t.queue[s.id]}),this.socket.addEventListener("error",function(u){return t.emit("error",u)}),this.socket.addEventListener("close",function(u){var s=u.code,a=u.reason;t.ready&&setTimeout(function(){return t.emit("close",s,a)},0),t.ready=!1,t.socket=void 0,s!==1e3&&(t.current_reconnects++,t.reconnect&&(t.max_reconnects>t.current_reconnects||t.max_reconnects===0)&&(t.reconnect_timer_id=setTimeout(function(){return t._connect(e,v)},t.reconnect_interval)))})}}]),p}(i.EventEmitter);C.default=l})(M);const Q=I(M);var D={};(function(C){var g=A;Object.defineProperty(C,"__esModule",{value:!0}),C.default=c;var d=g(j()),k=g(N()),q=g(T()),O=g(B()),w=g($()),y=F();function h(_){var m=o();return function(){var f=(0,w.default)(_),r;if(m){var p=(0,w.default)(this).constructor;r=Reflect.construct(f,arguments,p)}else r=f.apply(this,arguments);return(0,O.default)(this,r)}}function o(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var i=function(_){(0,q.default)(l,_);var m=h(l);function l(f,r,p){var n;return(0,d.default)(this,l),n=m.call(this),n.socket=new window.WebSocket(f,p),n.socket.onopen=function(){return n.emit("open")},n.socket.onmessage=function(e){return n.emit("message",e.data)},n.socket.onerror=function(e){return n.emit("error",e)},n.socket.onclose=function(e){n.emit("close",e.code,e.reason)},n}return(0,k.default)(l,[{key:"send",value:function(r,p,n){var e=n||p;try{this.socket.send(r),e()}catch(v){e(v)}}},{key:"close",value:function(r,p){this.socket.close(r,p)}},{key:"addEventListener",value:function(r,p,n){this.socket.addEventListener(r,p,n)}}]),l}(y.EventEmitter);function c(_,m){return new i(_,m)}})(D);const U=I(D);export{Q as R,U as c};
